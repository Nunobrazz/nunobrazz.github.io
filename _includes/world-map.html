<style>
    .world-map-section {
        margin: 1rem 0 2rem;
    }

    .world-map-section .map-header {
        text-align: center;
        margin-bottom: 1.5rem;
    }

    .world-map-section .map-title {
        font-family: 'Space Grotesk', sans-serif;
        font-size: 2rem;
        font-weight: 500;
        margin-bottom: 0.25rem;
    }

    .world-map-section .map-subtitle {
        font-family: 'Inter', sans-serif;
        font-size: 0.95rem;
        color: #6e7681;
    }

    .world-map-section .map-subtitle .highlight {
        color: #0096c7;
        font-weight: 600;
    }

    .world-map-section .map-container {
        position: relative;
        background: linear-gradient(145deg, #0d1117, #161b22 50%, #0d1117);
        border-radius: 16px;
        padding: 1rem 1.5rem;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.06);
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15), 0 1px 3px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.04);
    }

    .world-map-section .map-container svg {
        width: 100%;
        height: auto;
        display: block;
    }

    .world-map-section .map-container .sphere {
        fill: none;
        stroke: rgba(255, 255, 255, 0.08);
        stroke-width: 1;
    }

    .world-map-section .map-container .graticule {
        fill: none;
        stroke: rgba(255, 255, 255, 0.03);
        stroke-width: 0.5;
    }

    .world-map-section .map-container .country {
        fill: #21262d;
        stroke: #30363d;
        stroke-width: 0.5px;
        transition: fill 0.3s ease, filter 0.3s ease;
        cursor: default;
    }

    .world-map-section .map-container .country.visited {
        fill: #0077b6;
        cursor: pointer;
    }

    .world-map-section .map-container .country.visited:hover,
    .world-map-section .map-container .country.visited.active {
        fill: #00b4d8;
        filter: drop-shadow(0 0 8px rgba(0, 180, 216, 0.45));
    }

    .world-map-section .map-container .country-border {
        fill: none;
        stroke: #30363d;
        stroke-width: 0.5px;
        pointer-events: none;
    }

    .world-map-section .map-tooltip {
        position: absolute;
        pointer-events: none;
        background: rgba(13, 17, 23, 0.92);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(0, 150, 199, 0.25);
        border-radius: 10px;
        padding: 10px 14px;
        color: #e6edf3;
        font-family: 'Inter', sans-serif;
        font-size: 0.85rem;
        line-height: 1.4;
        opacity: 0;
        transition: opacity 0.2s ease;
        z-index: 100;
        max-width: 220px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    }

    .world-map-section .map-tooltip strong {
        color: #00b4d8;
        font-weight: 500;
        font-size: 0.9rem;
    }

    .world-map-section .map-tooltip p {
        margin: 4px 0 0;
        color: #8b949e;
        font-size: 0.8rem;
    }

    .world-map-section .map-legend {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1.2rem;
    }

    .world-map-section .map-legend .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-family: 'Inter', sans-serif;
        font-size: 0.8rem;
        color: #6e7681;
    }

    .world-map-section .map-legend .legend-color {
        width: 12px;
        height: 12px;
        border-radius: 3px;
        display: inline-block;
    }

    .world-map-section .map-legend .legend-item.visited .legend-color {
        background: #0077b6;
    }

    .world-map-section .map-legend .legend-item:not(.visited) .legend-color {
        background: #21262d;
        border: 1px solid #30363d;
    }

    @media (max-width: 768px) {
        .world-map-section .map-title {
            font-size: 1.5rem;
        }

        .world-map-section .map-container {
            padding: 0.5rem;
            border-radius: 12px;
        }
    }
</style>

<div class="world-map-section">
    <div class="map-header">
        <p class="map-subtitle">
            <span class="highlight" id="country-count">0</span>/195 countries across
            <span class="highlight">5/6</span> continents
        </p>
    </div>

    <div class="map-container" id="world-map">
        <div class="map-tooltip" id="map-tooltip"></div>
    </div>

    <div class="map-legend">
        <div class="legend-item visited">
            <span class="legend-color"></span>
            <span>Visited</span>
        </div>
        <div class="legend-item">
            <span class="legend-color"></span>
            <span>Not yet</span>
        </div>
    </div>
</div>

<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://unpkg.com/topojson-client@3"></script>
<script>
    (function () {
        const visitedCountries = {
            "620": { name: "Portugal", comment: "Home ðŸ " },
            "724": { name: "Spain", comment: "ðŸ‡ªðŸ‡¸" },
            "250": { name: "France", comment: "ðŸ‡«ðŸ‡·" },
            "380": { name: "Italy", comment: "ðŸ‡®ðŸ‡¹" },
            "616": { name: "Poland", comment: "ðŸ‡µðŸ‡±" },
            "826": { name: "United Kingdom", comment: "ðŸ‡¬ðŸ‡§" },
            "578": { name: "Norway", comment: "ðŸ‡³ðŸ‡´" },
            "752": { name: "Sweden", comment: "ðŸ‡¸ðŸ‡ª" },
            "076": { name: "Brazil", comment: "Delivered Master Thesis. ðŸ‡§ðŸ‡·" },
            "032": { name: "Argentina", comment: "Exchange semester. â¤ï¸" },
            "156": { name: "China", comment: "Summer exchange at Beijing Institute of Technology. ðŸ‡¨ðŸ‡³" },
            "360": { name: "Indonesia", comment: "Volunteering at Batu Kapal Conservation. ðŸ¦§" },
            "068": { name: "Bolivia", comment: "High altitude, big landscapes. ðŸ‡§ðŸ‡´" },
            "604": { name: "Peru", comment: "Colorful streets and music. ðŸ‡µðŸ‡ª" },
            "858": { name: "Uruguay", comment: "Good meat and unexpected wind. ðŸ‡ºðŸ‡¾" },
            "170": { name: "Colombia", comment: "South American vibes. ðŸ‡¨ðŸ‡´" },
            "840": { name: "United States", comment: "Big cities, bigger distances. ðŸ‡ºðŸ‡¸" },
            "124": { name: "Canada", comment: "Pretty Lakes. ðŸ‡¨ðŸ‡¦" },
            "132": { name: "Cape Verde", comment: "High-school trip. ðŸ‡¨ðŸ‡»" },
            "702": { name: "Singapore", comment: "Efficient, and futuristic. ðŸ‡¸ðŸ‡¬" },
            "348": { name: "Hungary", comment: "First big trip with friends. ðŸ‡­ðŸ‡º" }
        };

        // This counts the keys in your list and updates the HTML
        document.getElementById('country-count').innerText = Object.keys(visitedCountries).length;
        const container = document.getElementById('world-map');
        const tooltip = document.getElementById('map-tooltip');
        const width = 960;
        const height = 500;

        const svg = d3.select('#world-map')
            .append('svg')
            .attr('viewBox', `0 0 ${width} ${height}`)
            .attr('preserveAspectRatio', 'xMidYMid meet');

        const projection = d3.geoNaturalEarth1()
            .scale(155)
            .translate([width / 2, height / 2]);

        const path = d3.geoPath().projection(projection);

        svg.append('path')
            .datum(d3.geoGraticule().step([20, 20])())
            .attr('class', 'graticule')
            .attr('d', path);

        svg.append('path')
            .datum({ type: 'Sphere' })
            .attr('class', 'sphere')
            .attr('d', path);

        // Updated URL and added error catching
        d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json')
            .then(world => {
                const countries = topojson.feature(world, world.objects.countries);

                svg.selectAll('.country')
                    .data(countries.features)
                    .enter()
                    .append('path')
                    .attr('d', path)
                    .attr('class', d => visitedCountries[d.id] ? 'country visited' : 'country')
                    .on('mouseenter', function (event, d) {
                        if (visitedCountries[d.id]) {
                            const info = visitedCountries[d.id];
                            tooltip.innerHTML = `<strong>${info.name}</strong><p>${info.comment}</p>`;
                            tooltip.style.opacity = '1';
                            d3.select(this).classed('active', true).raise();
                        }
                    })
                    .on('mousemove', (event) => {
                        const rect = container.getBoundingClientRect();
                        let x = event.clientX - rect.left + 15;
                        let y = event.clientY - rect.top - 15;
                        if (x + tooltip.offsetWidth > rect.width - 10) x = event.clientX - rect.left - tooltip.offsetWidth - 15;
                        tooltip.style.left = `${x}px`;
                        tooltip.style.top = `${y}px`;
                    })
                    .on('mouseleave', function () {
                        tooltip.style.opacity = '0';
                        d3.select(this).classed('active', false);
                    });

                svg.append('path')
                    .datum(topojson.mesh(world, world.objects.countries, (a, b) => a !== b))
                    .attr('class', 'country-border')
                    .attr('d', path);
            })
            .catch(err => console.error("Map loading failed:", err));
    })();
</script>